<!DOCTYPE html>
<html lang="en"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="title">Self-Sustained Penrose Excitation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Cosmic Neutrals (Dark Theme) -->
    <!-- Application Structure Plan: Sequential flow mimicking the paper: Introduction -> Core Mechanism (with animation) -> Simulator (interactive chart) -> Validation (Hooks/Kill-shots) -> Conclusion. Emphasis on visual explanation of the Penrose split and spin-threshold behavior. -->
    <!-- Visualization & Content Choices: 1. Core Mechanism: HTML/CSS animation showing plasmoid split, energy branches, disk heating. 2. Simulator: Chart.js line graph of L/L_Edd vs a*, dynamically updated via sliders (a*, Îµ_coup), showing threshold behavior. 3. Validation: Structured HTML list for Hooks/Kill-shots. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #111827; /* Dark blue-gray background */
            color: #d1d5db; /* Light gray text */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            height: 400px; /* Base height */
            max-height: 50vh;
        }
        .glass-card {
            background: rgba(31, 41, 55, 0.5); /* Semi-transparent dark card */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .nav-link {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        .nav-link:hover, .nav-link.active {
            color: #38bdf8; /* Sky blue hover/active */
            border-bottom: 2px solid #38bdf8;
        }
        .math-variable, .small-math-variable {
            font-family: serif; /* Use serif for math */
            font-style: italic;
            white-space: nowrap; /* Prevent line breaks within math */
        }
        .small-math-variable { font-size: 0.9em; }
        
        /* Animation elements */
        #animation-canvas {
            position: relative;
            width: 300px;
            height: 200px;
            margin: auto;
            overflow: hidden;
            background-color: #000;
            border-radius: 8px;
            border: 1px solid #4b5563; /* Gray border */
        }
        .ergosphere {
            position: absolute;
            top: 10%; left: 10%;
            width: 80%; height: 80%;
            border: 2px dashed #fcd34d; /* Yellow dashed */
            border-radius: 50%;
            opacity: 0.7;
        }
        .event-horizon {
            position: absolute;
            top: 30%; left: 30%;
            width: 40%; height: 40%;
            background-color: #000;
            border: 2px solid #6b7280; /* Gray solid */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #9ca3af;
        }
        .plasmoid {
            position: absolute;
            width: 15px; height: 15px;
            background-color: #fcd34d; /* Yellow */
            border-radius: 50%;
            top: 50%; left: 85%;
            transform: translate(-50%, -50%);
            transition: all 1s ease-in-out;
            z-index: 10;
        }
        .neg-energy {
            position: absolute;
            width: 10px; height: 10px;
            background-color: #f87171; /* Red */
            border-radius: 50%;
            opacity: 0;
            transition: all 0.8s ease-in;
            z-index: 5;
        }
        .pos-energy {
            position: absolute;
            width: 10px; height: 10px;
            background-color: #34d399; /* Green */
            border-radius: 50%;
            opacity: 0;
            transition: all 1.2s ease-out;
            z-index: 5;
        }
        .disk-heating {
            position: absolute;
            bottom: 10%; right: 5%;
            width: 30px; height: 10px;
            background: linear-gradient(to right, transparent, #fde047); /* Yellow glow */
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.5s ease-out;
        }
        .doi-button-top {
            margin-top: 1rem;
            margin-bottom: 2rem;
        }
        .hook-box {
            border-left: 4px solid #34d399; /* Tailwind green-400 */
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 py-8">

        <div class="flex justify-end mb-4">
            <button id="lang-toggle-ja" class="font-bold py-1 px-3 rounded-l-lg transition-colors text-gray-400 bg-gray-700 hover:bg-gray-600" aria-label="Switch language to Japanese">JP</button>
            <button id="lang-toggle-en" class="font-bold py-1 px-3 rounded-r-lg transition-colors text-white bg-sky-600 hover:bg-sky-500" aria-label="Switch language to English">EN</button>
        </div>

        <header class="text-center mb-6 md:mb-10">
            <h1 class="text-3xl md:text-5xl font-bold text-white mb-2" data-key="title">Self-Sustained Penrose Excitation</h1>
            <p class="text-lg md:text-xl text-sky-300" data-key="subtitle">A Spin-Regulated Mechanism for Super-Eddington Quasar Luminosities</p>
             <p class="mt-2 max-w-3xl mx-auto text-gray-500 text-sm italic">
                <span data-key="version_label">Version</span> v1.1.14 &mdash; <span data-key="covenant_header">Final Judge: Jun Wakabayashi. Code implementation assisted by Google Gemini.</span>
            </p>
        </header>

        <div class="text-center doi-button-top">
            <a id="doi-button-top" href="https://doi.org/10.17605/OSF.IO/Q7DTH" target="_blank" rel="noopener noreferrer" class="inline-block bg-yellow-500 text-gray-900 font-bold py-2 px-6 rounded-lg hover:bg-yellow-400 transition-colors shadow-lg" data-key="read_original_paper">
                Read Original Paper (OSF DOI)
            </a>
        </div>

        <nav class="sticky top-0 z-10 glass-card rounded-lg mb-12">
            <ul class="flex items-center justify-center p-2 space-x-4 md:space-x-8 text-sm md:text-base font-medium text-gray-300">
                <li><a class="nav-link active" data-target="introduction" data-key="nav_intro">Introduction</a></li>
                <li><a class="nav-link" data-target="mechanism" data-key="nav_mech">Core Mechanism</a></li>
                <li><a class="nav-link" data-target="simulator" data-key="nav_sim">Simulator</a></li>
                <li><a class="nav-link" data-target="validation" data-key="nav_hook">Validation</a></li>
                <li><a class="nav-link" data-target="conclusion" data-key="nav_conc">Conclusion</a></li>
            </ul>
        </nav>

        <main>
            <section id="introduction" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center" data-key="sec1_title">1. The Puzzle: Super-Eddington Quasars & Spin Ceiling</h2>
                 <div class="glass-card rounded-lg p-6 md:p-8">
                     <p class="mb-4 text-base md:text-lg leading-relaxed" data-key="sec1_p1">Many quasars shine brighter than the Eddington limit ($L_{\rm Edd}$) allows, sometimes by factors of 2-10x. Standard accretion disk models struggle to explain this sustained super-Eddington output. Furthermore, observations suggest SMBH spins ($a_{*}$) rarely, if ever, exceed unity, hinting at a self-regulating mechanism.</p>
                     <p class="text-base md:text-lg leading-relaxed" data-key="sec1_p2">This framework proposes a **self-sustained Penrose excitation** mechanism operating near the black hole's event horizon for rapidly spinning SMBHs ($a_{*} \to 1$). This equatorial process can explain both phenomena: sustained super-Eddington luminosities and a natural spin ceiling below unity.</p>
                </div>
            </section>

            <section id="mechanism" class="mb-16 scroll-mt-24">
                <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center" data-key="sec2_title">2. Core Mechanism: Equatorial Penrose Excitation</h2>
                <div class="glass-card rounded-lg p-6 md:p-8 grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div>
                        <h3 class="font-bold text-lg text-white mb-2" data-key="sec2_subtitle">How it Works: A Leaky Return Path</h3>
                        <p class="text-sm text-gray-400 mb-4 leading-relaxed" data-key="sec2_p1">Near extremal spin ($a_{*} \to 1$), the Innermost Stable Circular Orbit (ISCO) approaches the ergoregion boundary. An equatorial return current sheet forms at this interface. Magnetic reconnection ejects plasmoids (magnetic islands).</p>
                        <p class="text-sm text-gray-400 mb-4 leading-relaxed" data-key="sec2_p2">Within the ergoregion, these plasmoids undergo a **Penrose split**: a negative-energy branch ($E - \Omega_{H}L < 0$) falls into the black hole, while a positive-energy branch escapes as a narrow **equatorial quasi-beam**.</p>
                        <p class="text-sm text-gray-400 leading-relaxed" data-key="sec2_p3">A fraction ($\epsilon_{\rm coup}$) of this beam reheats the inner accretion disk, boosting luminosity and extracting angular momentum from the black hole, thus enforcing a spin ceiling.</p>
                        <div class="mt-6 text-center">
                             <button id="animate-button" class="bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-500 transition-colors" data-key="run_animation">Run Animation</button>
                        </div>
                    </div>
                    <div id="animation-canvas" aria-hidden="true">
                        <div class="ergosphere" title="Ergosphere"></div>
                        <div class="event-horizon" title="Event Horizon">BH</div>
                        <div id="plasmoid" class="plasmoid" title="Plasmoid"></div>
                        <div id="neg-energy" class="neg-energy" title="Negative Energy Branch"></div>
                        <div id="pos-energy" class="pos-energy" title="Positive Energy Branch"></div>
                        <div id="disk-heating" class="disk-heating" title="Disk Heating"></div>
                        <div class="absolute top-2 left-2 text-xs text-yellow-300" data-key="anim_label_ergo">Ergosphere</div>
                        <div class="absolute bottom-2 right-2 text-xs text-sky-300" data-key="anim_label_disk">Inner Disk Edge</div>
                    </div>
                </div>
            </section>

            <section id="simulator" class="mb-16 scroll-mt-24">
                 <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center" data-key="sec3_title">3. Interactive Simulator: Spin & Luminosity</h2>
                <div class="glass-card rounded-lg p-4 md:p-8">
                     <p class="text-center max-w-3xl mx-auto mb-8 text-gray-400" data-key="sec3_intro">Explore how the black hole spin ($a_{*}$) and the coupling efficiency ($\epsilon_{\rm coup}$) influence the total luminosity ($L_{\rm tot}/L_{\rm Edd}$) in this model. Notice the sharp rise above the threshold spin $a_{\rm th} \approx 0.97$.</p>
                    <p class="text-center text-xs italic text-gray-500 mb-6" data-key="sec3_note">(Note: Numbers are illustrative, capturing the threshold behavior. Assumes $L_{acc} = 1 L_{Edd}$ base.)</p>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1 space-y-6">
                            <div>
                                <label for="spin" class="font-medium text-white" data-key="spin_label">Black Hole Spin ($a_{*}$)</label>
                                <input id="spin" type="range" min="0.90" max="0.999" step="0.001" value="0.980" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span data-key="spin_low">Fast Rotation (0.9)</span>
                                    <span id="spin-value" class="font-bold text-sky-300">0.980</span>
                                    <span data-key="spin_high">Extreme Spin (1.0)</span>
                                </div>
                                <p class="text-sm text-gray-400 mt-2" data-key="spin_desc">As spin approaches 1.0, the ergosphere expands, drastically increasing the efficiency of energy extraction.</p>
                            </div>
                            <div>
                                <label for="coupling" class="font-medium text-white" data-key="coup_label">Coupling Efficiency ($\epsilon_{\rm coup}$)</label>
                                <input id="coupling" type="range" min="0.001" max="0.1" step="0.001" value="0.010" class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-xs text-gray-400 mt-1">
                                    <span data-key="coup_low">Low (0.001)</span>
                                    <span id="coupling-value" class="font-bold text-sky-300">0.010</span>
                                    <span data-key="coup_high">High (0.1)</span>
                                </div>
                                <p class="text-sm text-gray-400 mt-2" data-key="coup_desc">Indicates how efficiently the BH's rotational energy is converted into heat for the accretion disk.</p>
                            </div>
                             <div class="bg-gray-900/50 rounded-lg p-4 text-center">
                                <h3 class="font-bold text-lg text-white" data-key="lum_pred_title">Predicted Luminosity ($L_{\rm tot}/L_{\rm Edd}$)</h3>
                                <p class="text-4xl font-mono my-2 text-yellow-300"><span id="luminosity-value">2.50</span></p>
                                <p class="text-sm text-gray-300" data-key="lum_pred_desc">Stable Super-Eddington luminosity. This is the typical state observed in many quasars.</p>
                            </div>
                        </div>
                        <div class="lg:col-span-2">
                            <div class="chart-container">
                                <canvas id="luminosityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

             <section id="validation" class="mb-16 scroll-mt-24">
                 <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center" data-key="sec4_title">4. Validation: Hooks & Kill-shots</h2>
                 <div class="glass-card rounded-lg p-6 md:p-8 hook-box pl-6">
                    <h3 class="text-white font-bold mb-4 text-xl" data-key="hook_box_title">Observational Hooks / Falsification Criteria</h3>
                     
                     <p id="validation-target-ja" class="text-gray-400 text-sm mb-3 hidden" data-key="validation_target_ja">
                        å¯¾è±¡ã¯ <b>é«ã¹ãã³</b> ($a_{*} > a_{\rm th}$), <b>é«Eddæ¯</b> ($\lambda$é«), éææ¡ä»¶ <b>&#8467; &lesssim; 30</b>.
                     </p>
                    <p id="validation-target-en" class="text-gray-400 text-sm mb-3" data-key="validation_target_en">
                        Target: <b>high spin</b> ($a_{*} > a_{\rm th}$), <b>high Eddington ratio</b> ($\lambda$ high), transparency <b>&#8467; &lesssim; 30</b>.
                    </p>

                    <ul class="list-disc list-inside text-gray-300 text-sm leading-6 space-y-2">
                        <li>
                            <b data-key="hook_title">Hooks (Support):</b> <span data-key="hook_desc">energy-dependent Fe K$\alpha$/UV lags; spin-dependent polarization; EUV/MeV <b>shoulder</b>.</span>
                        </li>
                        <li class="mt-4">
                            <b class="text-red-400" data-key="killshot_title">Kill-shots (Falsification):</b>
                             <p id="killshot-criteria-ja" class="text-gray-400 text-xs my-2 hidden" data-key="killshot_criteria_ja">
                                <b>Kill-shotã®å¤å®ï¼</b> ä»¥ä¸ã®4é ç®ã®ãã¡ <b>2é ç®ä»¥ä¸</b> ãç¶ç¶çã«è¦³æ¸¬ãããå ´åãã¢ãã«ãæ£å´ãã¾ãã
                            </p>
                            <p id="killshot-criteria-en" class="text-gray-400 text-xs my-2" data-key="killshot_criteria_en">
                                Kill-shot Criteria: Model is falsified if <b>$\ge 2$ items</b> below persistently hold.
                            </p>
                            <ol class="list-decimal ml-5 space-y-1">
                                <li data-key="killshot_1">Persistent absence of a <b>MeV shoulder</b> (high spin & high $\lambda$).</li>
                                <li data-key="killshot_2">No <b>energy dependence</b> in the X$\to$UV lag.</li>
                                <li data-key="killshot_3">No <b>negative correlation</b> between $L_{\rm bol}$ and $a_{*}$.</li>
                                <li data-key="killshot_4">Polarization <b>isotropic</b> or <b>polar-dominated</b> (not equatorial).</li>
                            </ol>
                        </li>
                    </ul>
                </div>
            </section>

             <section id="conclusion" class="scroll-mt-24">
                <h2 class="text-2xl md:text-3xl font-bold text-white mb-6 text-center" data-key="sec5_title">5. Conclusion & Significance</h2>
                <div class="glass-card rounded-lg p-6 md:p-8">
                     <p class="mb-6 text-base md:text-lg leading-relaxed" data-key="sec5_intro">This self-sustained Penrose excitation framework provides a testable explanation for both super-Eddington quasar luminosities and the observed spin ceiling near unity. It complements other models like slim disks (no ceiling) or BZ/MAD jets (polar power).</p>
                    <ul class="space-y-4">
                        <li class="flex items-start">
                             <span class="text-sky-400 mr-3 mt-1">&#10003;</span>
                             <div>
                                <h3 class="font-bold text-white" data-key="concl_1_title">Explains Key Observations</h3>
                                <p class="text-gray-400" data-key="concl_1_desc">Sustains $L/L_{\rm Edd} \sim 2-3$ (up to 10x) and naturally enforces $a_{*} < 1$ through angular momentum extraction.</p>
                             </div>
                        </li>
                         <li class="flex items-start">
                             <span class="text-sky-400 mr-3 mt-1">&#10003;</span>
                            <div>
                                <h3 class="font-bold text-white" data-key="concl_2_title">Testable & Falsifiable</h3>
                                <p class="text-gray-400" data-key="concl_2_desc">Predicts specific observational signatures (Hooks) and provides clear conditions for falsification (Kill-shots), enabling immediate confrontation with data.</p>
                            </div>
                        </li>
                    </ul>
                     <div class="mt-8 text-center">
                        <a href="https://doi.org/10.17605/OSF.IO/Q7DTH" target="_blank" rel="noopener noreferrer" class="inline-block bg-sky-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-sky-500 transition-colors" data-key="read_original_paper">
                            Read Original Paper (OSF DOI)
                        </a>
                    </div>
                </div>
            </section>
        </main>

        <footer class="mt-12 text-center text-xs text-gray-400">
             <p data-key="covenant_footer">Final Judge: Jun Wakabayashi. Code implementation assisted by Google Gemini, provided "as is" without warranty. Responsibility for validation and interpretation rests with the user and domain teams.</p>
        </footer>
    </div>

    <script>
        // --- Configuration & Constants ---
        const A_THRESHOLD = 0.97;
        const SPIN_MAX = 0.999;
        const N_SHARPNESS = 2; // Activation sharpness

        let currentLang = 'en'; // Default language set to English
        let luminosityChart;
        let animationTimeout;

        const LANG_DATA = {
             'ja': {
                'title': 'èªå·±ç¶­æãã³ã­ã¼ãºå±èµ·',
                'subtitle': 'è¶ã¨ãã£ã³ãã³ååº¦ã¯ã¨ã¼ãµã¼ã®ããã®ã¹ãã³å¶å¾¡ã¡ã«ããºã ',
                'version_label': 'ãã¼ã¸ã§ã³',
                'covenant_header': 'æçµå¤å®è: è¥æ æ½¤ã ã³ã¼ãå®è£æ¯æ´: Google Gemini.',
                'covenant_footer': 'æçµå¤å®è: è¥æ æ½¤ãã³ã¼ãå®è£æ¯æ´: Google Geminiãç¾ç¶æå§¿ã§æä¾ãä¿è¨¼ãªããæ¤è¨¼ã¨è§£éã®è²¬ä»»ã¯å©ç¨èã¨ãã¡ã¤ã³ãã¼ã ã«ããã¾ãã',
                'nav_intro': 'åºè«',
                'nav_mech': 'æ ¸å¿ã¡ã«ããºã ',
                'nav_sim': 'ã·ãã¥ã¬ã¼ã¿',
                'nav_hook': 'æ¤è¨¼',
                'nav_conc': 'çµè«',
                'read_original_paper': 'åæè«æãèª­ã (OSF DOI)',
                'sec1_title': '1. è¬ï¼è¶ã¨ãã£ã³ãã³ååº¦ã¯ã¨ã¼ãµã¼ã¨ã¹ãã³å¤©äº',
                'sec1_p1': 'å¤ãã®ã¯ã¨ã¼ãµã¼ã¯ããã®ä¸­å¿SMBHã®ã¨ãã£ã³ãã³éç ($L_{\rm Edd}$) ãæ°åãã10åè¶ããååº¦ã§è¼ãã¦ãã¾ããæ¨æºçãªéçåç¤ã¢ãã«ã§ã¯ããã®æç¶çãªè¶ã¨ãã£ã³ãã³åºåãèª¬æãããã¨ã¯å°é£ã§ããããã«ãè¦³æ¸¬ã¯SMBHã®ã¹ãã³ ($a_{*}$) ãã»ã¨ãã©ã®å ´å1ãè¶ããªããã¨ãç¤ºåãã¦ãããèªå·±èª¿ç¯ã¡ã«ããºã ã®å­å¨ãåããã¦ãã¾ãã',
                'sec1_p2': 'æ¬ãã¬ã¼ã ã¯ã¼ã¯ã¯ãæ¥éã«åè»¢ããSMBH ($a_{*} \to 1$) ã®ã¤ãã³ããã©ã¤ãºã³è¿åã§åä½ãã**èªå·±ç¶­æãã³ã­ã¼ãºå±èµ·**ã¡ã«ããºã ãææ¡ãã¾ãããã®èµ¤éé¢ãã­ã»ã¹ã¯ãæç¶çãªè¶ã¨ãã£ã³ãã³ååº¦ã¨1æªæºã®èªç¶ãªã¹ãã³å¤©äºã®ä¸¡æ¹ãèª¬æã§ãã¾ãã',
                'sec2_title': '2. æ ¸å¿ã¡ã«ããºã ï¼èµ¤éé¢ãã³ã­ã¼ãºå±èµ·',
                'sec2_subtitle': 'ä»çµã¿ï¼æ¼ãã®ãããªã¿ã¼ã³ãã¹',
                'sec2_p1': 'æ¥µéã¹ãã³ ($a_{*} \to 1$) ã«è¿ã¥ãã¨ãæåå®å®åè»é (ISCO) ãã¨ã«ã´é åå¢çã«æ¥è¿ãã¾ãããã®çé¢ã«èµ¤éé¢ãªã¿ã¼ã³é»æµã·ã¼ããå½¢æããã¾ããç£æ°ãªã³ãã¯ã·ã§ã³ã«ãããã©ãºã¢ã¤ãï¼ç£æ°å³¶ï¼ãæ¾åºããã¾ãã',
                'sec2_p2': 'ã¨ã«ã´é ååã§ããããã®ãã©ãºã¢ã¤ãã¯**ãã³ã­ã¼ãºåè£**ãèµ·ããã¾ãï¼è² ã®ã¨ãã«ã®ã¼åå² ($E - \Omega_{H}L < 0$) ããã©ãã¯ãã¼ã«ã«è½ä¸ããæ­£ã®ã¨ãã«ã®ã¼åå²ãç­ã**èµ¤éé¢æºãã¼ã **ã¨ãã¦è±åºãã¾ãã',
                'sec2_p3': 'ãã®ãã¼ã ã®ä¸é¨ ($\epsilon_{\rm coup}$) ãåé¨éçåç¤ãåå ç±ããååº¦ãé«ãããã©ãã¯ãã¼ã«ããè§éåéãæ½åºããããã«ãã£ã¦ã¹ãã³å¤©äºãå¼·å¶ãã¾ãã',
                'run_animation': 'ã¢ãã¡ã¼ã·ã§ã³å®è¡',
                'anim_label_ergo': 'ã¨ã«ã´é å',
                'anim_label_disk': 'åç¤åç¸',
                'sec3_title': '3. ã¤ã³ã¿ã©ã¯ãã£ãã»ã·ãã¥ã¬ã¼ã¿ï¼ã¹ãã³ã¨ååº¦',
                'sec3_intro': 'ãã©ãã¯ãã¼ã«ã¹ãã³ ($a_{*}$) ã¨çµåå¹ç ($\epsilon_{\rm coup}$) ãããã®ã¢ãã«ã«ãããç·ååº¦ ($L_{\rm tot}/L_{\rm Edd}$) ã«ã©ã®ããã«å½±é¿ããããæ¢ãã¾ããé¾å¤ã¹ãã³ $a_{\rm th} \approx 0.97$ ãè¶ããã¨æ¥æ¿ã«ç«ã¡ä¸ããç¹ã«æ³¨ç®ãã¦ãã ããã',
                 'sec3_note': 'ï¼æ³¨è¨ï¼æ°å¤ã¯é¾å¤æåãæããããã®ä¾ç¤ºã§ããåºç¤ã¨ãã¦ $L_{acc} = 1 L_{Edd}$ ãä»®å®ãï¼',
                'spin_label': 'ãã©ãã¯ãã¼ã«ã»ã¹ãã³ ($a_{*}$)',
                'spin_low': 'é«éåè»¢ (0.9)',
                'spin_high': 'æ¥µéã¹ãã³ (1.0)',
                'spin_desc': 'ã¹ãã³ã1.0ã«è¿ã¥ãã¨ãã¨ã«ã´é åãæ¡å¤§ããã¨ãã«ã®ã¼æ½åºå¹çãåçã«åä¸ãã¾ãã',
                'coup_label': 'çµåå¹ç ($\epsilon_{\rm coup}$)',
                'coup_low': 'ä½ã (0.001)',
                'coup_high': 'é«ã (0.1)',
                'coup_desc': 'BHã®åè»¢ã¨ãã«ã®ã¼ãéçåç¤ã®ç±ã«ã©ãã ãå¹ççã«å¤æãããããç¤ºãã¾ãã',
                'lum_pred_title': 'äºæ¸¬ååº¦ ($L_{\rm tot}/L_{\rm Edd}$)',
                'lum_pred_desc': 'å®å®ããè¶ã¨ãã£ã³ãã³ååº¦ãããã¯å¤ãã®ã¯ã¨ã¼ãµã¼ã§è¦³æ¸¬ãããå¸åçãªç¶æã§ãã',
                'chart_y_title': 'å¨ååº¦ ($L_{\\rm tot}/L_{\\rm Edd}$)',
                'chart_x_title': 'ãã©ãã¯ãã¼ã«ã»ã¹ãã³ ($a_{*}$)',
                'sec4_title': '4. æ¤è¨¼ï¼ããã¯ã¨ã­ã«ã·ã§ãã',
                'hook_box_title': 'è¦³æ¸¬ããã¯ / åè¨¼æ¡ä»¶ (Hooks & Kill-shots)',
                 'validation_target_ja': 'å¯¾è±¡ã¯ <b>é«ã¹ãã³</b> ($a_{*} > a_{\rm th}$), <b>é«Eddæ¯</b> ($\lambda$é«), éææ¡ä»¶ <b>&#8467; &lesssim; 30</b>.',
                 'hook_title': 'ããã¯ï¼æ¯æï¼:',
                 'hook_desc': 'ã¨ãã«ã®ã¼ä¾å­ Fe K$\alpha$/UV ã©ã°ï¼ ã¹ãã³ä¾å­ååï¼ EUV/MeV <b>è©</b>ã',
                'killshot_title': 'ã­ã«ã·ã§ããï¼æ£å´ï¼:',
                'killshot_criteria_ja': '<b>Kill-shotã®å¤å®ï¼</b> ä»¥ä¸ã®4é ç®ã®ãã¡ <b>2é ç®ä»¥ä¸</b> ãç¶ç¶çã«è¦³æ¸¬ãããå ´åãã¢ãã«ãæ£å´ãã¾ãã',
                 'killshot_1': '<b>MeVè©</b>ã®æç¶çãªä¸å¨ï¼é«ã¹ãã³ï¼é«$\lambda$ï¼ã',
                 'killshot_2': 'X$\to$UVã©ã°ã«<b>ã¨ãã«ã®ã¼ä¾å­æ§</b>ããªãã',
                 'killshot_3': '$L_{\rm bol}$ã¨$a_{*}$ã®éã«<b>è² ã®ç¸é¢</b>ããªãã',
                 'killshot_4': 'ååã<b>ç­æ¹ç</b>ã¾ãã¯<b>æ¥µæ¹åä¸»å°</b>ï¼èµ¤éé¢ã§ãªãï¼ã',
                'sec5_title': '5. çµè«ã¨æç¾©',
                'sec5_intro': 'ãã®èªå·±ç¶­æãã³ã­ã¼ãºå±èµ·ãã¬ã¼ã ã¯ã¼ã¯ã¯ãè¶ã¨ãã£ã³ãã³ååº¦ã¯ã¨ã¼ãµã¼ã¨è¦³æ¸¬ãããã¹ãã³å¤©äºã®ä¸¡æ¹ã«å¯¾ãã¦ãæ¤è¨¼å¯è½ãªèª¬æãæä¾ãã¾ããããã¯ãã¹ãªã ãã£ã¹ã¯ï¼å¤©äºãªãï¼ãBZ/MADã¸ã§ããï¼æ¥µæ¹åãã¯ã¼ï¼ã®ãããªä»ã®ã¢ãã«ãè£å®ãããã®ã§ãã',
                'concl_1_title': 'ä¸»è¦ãªè¦³æ¸¬ã®èª¬æ',
                'concl_1_desc': '$L/L_{\rm Edd} \sim 2-3$ï¼æå¤§10åï¼ãæç¶ãããè§éåéæ½åºãéãã¦èªç¶ã« $a_{*} < 1$ ãå¼·å¶ãã¾ãã',
                'concl_2_title': 'æ¤è¨¼å¯è½ï¼åè¨¼å¯è½',
                'concl_2_desc': 'ç¹å®ã®è¦³æ¸¬çç¹å¾´ï¼ããã¯ï¼ãäºæ¸¬ããåè¨¼ã®ããã®æç¢ºãªæ¡ä»¶ï¼ã­ã«ã·ã§ããï¼ãæä¾ãããã¨ã§ããã¼ã¿ã¨ã®å³æã®å¯¾æ±ºãå¯è½ã«ãã¾ãã'
            },
            'en': {
                 'title': 'Self-Sustained Penrose Excitation',
                 'subtitle': 'A Spin-Regulated Mechanism for Super-Eddington Quasar Luminosities',
                 'version_label': 'Version',
                 'covenant_header': 'Final Judge: Jun Wakabayashi. Code implementation assisted by Google Gemini.',
                 'covenant_footer': 'Final Judge: Jun Wakabayashi. Code implementation assisted by Google Gemini, provided "as is" without warranty. Responsibility for validation and interpretation rests with the user and domain teams.',
                 'nav_intro': 'Introduction',
                 'nav_mech': 'Core Mechanism',
                 'nav_sim': 'Simulator',
                 'nav_hook': 'Validation',
                 'nav_conc': 'Conclusion',
                 'read_original_paper': 'Read Original Paper (OSF DOI)',
                 'sec1_title': '1. The Puzzle: Super-Eddington Quasars & Spin Ceiling',
                 'sec1_p1': 'Many quasars shine brighter than the Eddington limit ($L_{\rm Edd}$) allows, sometimes by factors of 2-10x. Standard accretion disk models struggle to explain this sustained super-Eddington output. Furthermore, observations suggest SMBH spins ($a_{*}$) rarely, if ever, exceed unity, hinting at a self-regulating mechanism.',
                 'sec1_p2': 'This framework proposes a **self-sustained Penrose excitation** mechanism operating near the black hole\'s event horizon for rapidly spinning SMBHs ($a_{*} \to 1$). This equatorial process can explain both phenomena: sustained super-Eddington luminosities and a natural spin ceiling below unity.',
                 'sec2_title': '2. Core Mechanism: Equatorial Penrose Excitation',
                 'sec2_subtitle': 'How it Works: A Leaky Return Path',
                 'sec2_p1': 'Near extremal spin ($a_{*} \to 1$), the Innermost Stable Circular Orbit (ISCO) approaches the ergoregion boundary. An equatorial return current sheet forms at this interface. Magnetic reconnection ejects plasmoids (magnetic islands).',
                 'sec2_p2': 'Within the ergoregion, these plasmoids undergo a **Penrose split**: a negative-energy branch ($E - \Omega_{H}L < 0$) falls into the black hole, while a positive-energy branch escapes as a narrow **equatorial quasi-beam**.',
                 'sec2_p3': 'A fraction ($\epsilon_{\rm coup}$) of this beam reheats the inner accretion disk, boosting luminosity and extracting angular momentum from the black hole, thus enforcing a spin ceiling.',
                 'run_animation': 'Run Animation',
                 'anim_label_ergo': 'Ergosphere',
                 'anim_label_disk': 'Inner Disk Edge',
                 'sec3_title': '3. Interactive Simulator: Spin & Luminosity',
                 'sec3_intro': 'Explore how the black hole spin ($a_{*}$) and the coupling efficiency ($\epsilon_{\rm coup}$) influence the total luminosity ($L_{\rm tot}/L_{\rm Edd}$) in this model. Notice the sharp rise above the threshold spin $a_{\rm th} \approx 0.97$.',
                 'sec3_note': '(Note: Numbers are illustrative, capturing the threshold behavior. Assumes $L_{acc} = 1 L_{Edd}$ base.)',
                 'spin_label': 'Black Hole Spin ($a_{*}$)',
                 'spin_low': 'Fast Rotation (0.9)',
                 'spin_high': 'Extreme Spin (1.0)',
                 'spin_desc': 'As spin approaches 1.0, the ergosphere expands, drastically increasing the efficiency of energy extraction.',
                 'coup_label': 'Coupling Efficiency ($\epsilon_{\rm coup}$)',
                 'coup_low': 'Low (0.001)',
                 'coup_high': 'High (0.1)',
                 'coup_desc': 'Indicates how efficiently the BH\'s rotational energy is converted into heat for the accretion disk.',
                 'lum_pred_title': 'Predicted Luminosity ($L_{\rm tot}/L_{\rm Edd}$)',
                 'lum_pred_desc': 'Stable Super-Eddington luminosity. This is the typical state observed in many quasars.',
                 'chart_y_title': 'Total Luminosity ($L_{\\rm tot}/L_{\\rm Edd}$)',
                 'chart_x_title': 'Black Hole Spin ($a_{*}$)',
                 'sec4_title': '4. Validation: Hooks & Kill-shots',
                 'hook_box_title': 'Observational Hooks / Falsification Criteria',
                 'validation_target_en': 'Target: <b>high spin</b> ($a_{*} > a_{\rm th}$), <b>high Eddington ratio</b> ($\lambda$ high), transparency <b>&#8467; &lesssim; 30</b>.',
                 'hook_title': 'Hooks (Support):',
                 'hook_desc': 'energy-dependent Fe K$\alpha$/UV lags; spin-dependent polarization; EUV/MeV <b>shoulder</b>.',
                 'killshot_title': 'Kill-shots (Falsification):',
                'killshot_criteria_en': 'Kill-shot Criteria: Model is falsified if <b>$\ge 2$ items</b> below persistently hold.',
                 'killshot_1': 'Persistent absence of a <b>MeV shoulder</b> (high spin & high $\lambda$).',
                 'killshot_2': 'No <b>energy dependence</b> in the X$\to$UV lag.',
                 'killshot_3': 'No <b>negative correlation</b> between $L_{\rm bol}$ and $a_{*}$.',
                 'killshot_4': 'Polarization <b>isotropic</b> or <b>polar-dominated</b> (not equatorial).',
                 'sec5_title': '5. Conclusion & Significance',
                 'sec5_intro': 'This self-sustained Penrose excitation framework provides a testable explanation for both super-Eddington quasar luminosities and the observed spin ceiling near unity. It complements other models like slim disks (no ceiling) or BZ/MAD jets (polar power).',
                 'concl_1_title': 'Explains Key Observations',
                 'concl_1_desc': 'Sustains $L/L_{\rm Edd} \sim 2-3$ (up to 10x) and naturally enforces $a_{*} < 1$ through angular momentum extraction.',
                 'concl_2_title': 'Testable & Falsifiable',
                 'concl_2_desc': 'Predicts specific observational signatures (Hooks) and provides clear conditions for falsification (Kill-shots), enabling immediate confrontation with data.'
            }
        };

        // --- Core Simulation Logic ---
        function calculateSelfLuminosity(a_star, epsilon_coup) {
            if (a_star < A_THRESHOLD) {
                return 0; // Strictly zero below threshold
            }
            // Simplified model capturing the steep rise near a_th and divergence towards a=1
            // L_self ~ epsilon_coup * (a* - a_th)^n / (1 - a*)^0.5  (Conceptual, adjusted for smooth rise)
            const base_factor = epsilon_coup * 100; // Scale factor 
            const activation = Math.pow(Math.max(0, (a_star - A_THRESHOLD) / (1 - A_THRESHOLD)), N_SHARPNESS);
            const divergence = 1 / Math.sqrt(Math.max(1e-6, 1 - a_star)); // Avoid division by zero
            
            // Combine activation and divergence, ensure L_self > 0 only above threshold
            const L_self = base_factor * activation * (divergence - 1 / Math.sqrt(1 - A_THRESHOLD)); 
            return Math.max(0, L_self); // Ensure non-negative
        }

        function calculateTotalLuminosity(a_star, epsilon_coup) {
            const L_acc = 1.0; // Assume base accretion luminosity is 1 L_Edd
            const L_self = calculateSelfLuminosity(a_star, epsilon_coup);
            return L_acc + L_self;
        }

        // --- MathJax Initialization (Simulated for LaTeX) ---
         function applyMathStyles(html, isSmall = false) {
             const class_name = isSmall ? "small-math-variable" : "math-variable";
             // First handle specific complex commands like \lesssim and \ell
             html = html.replace(/\\lesssim/g, '&lesssim;') // Use HTML entity directly
                       .replace(/\\ell/g, '&#8467;');      // Use HTML entity directly

             // Then handle general math styling
             return html.replace(/\$([^\$]+)\$/g, (match, p1) => {
                 let innerHTML = p1
                    .replace(/\\rm /g, '')
                    .replace(/\\times/g, '&times;')
                    .replace(/\\cdot/g, '&middot;')
                    .replace(/\\to/g, '&rarr;')
                    .replace(/\\alpha/g, 'Î±')
                    .replace(/\\beta/g, 'Î²')
                    .replace(/\\gamma/g, 'Î³')
                    .replace(/\\lambda/g, 'Î»')
                    .replace(/\\epsilon/g, 'Îµ') // Added epsilon
                    .replace(/\\Omega/g, 'Î©') // Added Omega
                    .replace(/\\sim/g, '~')     // Added sim
                    .replace(/\\approx/g, 'â') // Added approx
                    .replace(/\\ge/g, 'â¥')     // Added ge
                    .replace(/\\le/g, 'â¤')     // Added le
                    .replace(/\\bol/g, 'bol')
                    .replace(/\{/g, '')
                    .replace(/\}/g, '')
                    .replace(/_/g, '<sub>')
                    .replace(/\*/g, '</sub>')
                    .replace(/\^/g, '<sup>') // Added superscript
                    .replace(/\\/g, ''); // Remove any remaining backslashes
                 return `<span class="${class_name}">${innerHTML}</span>`;
             });
         }


        function renderMath(lang, callback) {
             document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                let rawText = LANG_DATA[lang][key];

                if (!rawText) return;
                
                // Skip function types in LANG_DATA
                if (typeof rawText === 'function') {
                    return; 
                }

                el.innerHTML = applyMathStyles(rawText);
            });

             // Ensure specific blocks with potentially tricky HTML entities are rendered
            const validationTargetJa = document.getElementById('validation-target-ja');
            const validationTargetEn = document.getElementById('validation-target-en');
            const killshotCriteriaJa = document.getElementById('killshot-criteria-ja');
            const killshotCriteriaEn = document.getElementById('killshot-criteria-en');
            
            if (validationTargetJa) validationTargetJa.innerHTML = applyMathStyles(LANG_DATA['ja']['validation_target_ja']);
            if (validationTargetEn) validationTargetEn.innerHTML = applyMathStyles(LANG_DATA['en']['validation_target_en']);
            if (killshotCriteriaJa) killshotCriteriaJa.innerHTML = applyMathStyles(LANG_DATA['ja']['killshot_criteria_ja']);
            if (killshotCriteriaEn) killshotCriteriaEn.innerHTML = applyMathStyles(LANG_DATA['en']['killshot_criteria_en']);

            if (callback) {
                 setTimeout(callback, 50); // Small delay for rendering
            }
        }


        // --- Chart Update Logic ---
        function updateLuminosityChart() {
            const epsilon_coup = parseFloat(document.getElementById('coupling').value);
            const a_star_values = [];
            const L_tot_values = [];

            // Generate data points for the chart
            for (let a = 0.90; a <= SPIN_MAX; a += 0.001) {
                a_star_values.push(a);
                L_tot_values.push(calculateTotalLuminosity(a, epsilon_coup));
            }

            luminosityChart.data.labels = a_star_values;
            luminosityChart.data.datasets[0].data = L_tot_values;
            
            // Update axis titles based on language
            luminosityChart.options.scales.x.title.text = LANG_DATA[currentLang].chart_x_title || 'Black Hole Spin ($a_{*}$)';
            luminosityChart.options.scales.y.title.text = LANG_DATA[currentLang].chart_y_title || 'Total Luminosity ($L_{\\rm tot}/L_{\\rm Edd}$)';


            luminosityChart.update('none'); // Update without animation
        }
        
        // --- Animation Logic ---
        function runAnimation() {
            const plasmoid = document.getElementById('plasmoid');
            const negEnergy = document.getElementById('neg-energy');
            const posEnergy = document.getElementById('pos-energy');
            const diskHeating = document.getElementById('disk-heating');
            const button = document.getElementById('animate-button');

            button.disabled = true; // Prevent re-triggering

            // Reset positions and states
            clearTimeout(animationTimeout);
            plasmoid.style.transition = 'none';
            negEnergy.style.transition = 'none';
            posEnergy.style.transition = 'none';
            diskHeating.style.transition = 'none';

            plasmoid.style.left = '85%'; plasmoid.style.top = '50%';
            negEnergy.style.opacity = '0';
            posEnergy.style.opacity = '0';
            diskHeating.style.opacity = '0';

            // Animation sequence
            animationTimeout = setTimeout(() => {
                plasmoid.style.transition = 'all 1s ease-in-out';
                plasmoid.style.left = '50%'; // Move towards center/ergoregion
                
                animationTimeout = setTimeout(() => {
                    // Penrose Split
                    plasmoid.style.opacity = '0'; // Hide original plasmoid

                    negEnergy.style.left = '50%'; negEnergy.style.top = '50%';
                    negEnergy.style.opacity = '1';
                    negEnergy.style.transition = 'all 0.8s ease-in';
                    negEnergy.style.left = '40%'; negEnergy.style.top = '50%'; // Move into BH
                    negEnergy.style.transform = 'translate(-50%, -50%) scale(0.5)';

                    posEnergy.style.left = '50%'; posEnergy.style.top = '50%';
                    posEnergy.style.opacity = '1';
                    posEnergy.style.transition = 'all 1.2s ease-out';
                    posEnergy.style.left = '90%'; posEnergy.style.top = '45%'; // Move outward
                    
                    animationTimeout = setTimeout(() => {
                        // Disk Heating
                        diskHeating.style.opacity = '1';

                        animationTimeout = setTimeout(() => {
                             // Reset after a delay
                             plasmoid.style.transition = 'none';
                             plasmoid.style.opacity = '1';
                             plasmoid.style.left = '85%'; plasmoid.style.top = '50%';
                             negEnergy.style.opacity = '0';
                             posEnergy.style.opacity = '0';
                             diskHeating.style.opacity = '0';
                             button.disabled = false;
                        }, 1000); // Heating duration
                    }, 500); // Delay before heating starts
                }, 1000); // Time for split
            }, 100); // Initial delay
        }


        // --- Language and UI State Management ---
        function switchLanguage(lang) {
            currentLang = lang;
            
            const langToggleJa = document.getElementById('lang-toggle-ja');
            const langToggleEn = document.getElementById('lang-toggle-en');
            const validationTargetJa = document.getElementById('validation-target-ja');
            const validationTargetEn = document.getElementById('validation-target-en');
            const killshotCriteriaJa = document.getElementById('killshot-criteria-ja');
            const killshotCriteriaEn = document.getElementById('killshot-criteria-en');

            renderMath(lang, () => {
                // Update chart after math rendering
                updateLuminosityChart(); 
                // Toggle visibility for specific language blocks
                if (validationTargetJa && validationTargetEn) {
                     validationTargetJa.classList.toggle('hidden', lang === 'en');
                     validationTargetEn.classList.toggle('hidden', lang === 'ja');
                }
                 if (killshotCriteriaJa && killshotCriteriaEn) {
                     killshotCriteriaJa.classList.toggle('hidden', lang === 'en');
                     killshotCriteriaEn.classList.toggle('hidden', lang === 'ja');
                 }
                 // Update the main HTML lang attribute
                 document.documentElement.lang = lang; 
            });


            // Update button styles
            langToggleJa.classList.toggle('bg-sky-600', lang === 'ja');
            langToggleJa.classList.toggle('text-white', lang === 'ja');
            langToggleJa.classList.toggle('bg-gray-700', lang === 'en');
            langToggleJa.classList.toggle('text-gray-400', lang === 'en');

            langToggleEn.classList.toggle('bg-sky-600', lang === 'en');
            langToggleEn.classList.toggle('text-white', lang === 'en');
            langToggleEn.classList.toggle('bg-gray-700', lang === 'ja');
            langToggleEn.classList.toggle('text-gray-400', lang === 'ja');

        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const spinSlider = document.getElementById('spin');
            const couplingSlider = document.getElementById('coupling');
            const luminosityValue = document.getElementById('luminosity-value');
            const langToggleJa = document.getElementById('lang-toggle-ja');
            const langToggleEn = document.getElementById('lang-toggle-en');
            const animateButton = document.getElementById('animate-button');

            // --- Chart Initialization ---
            const ctx = document.getElementById('luminosityChart').getContext('2d');
             Chart.defaults.color = '#9ca3af'; // Default text color for chart
             Chart.defaults.borderColor = 'rgba(156, 163, 175, 0.1)'; // Grid line color

            luminosityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [], // a* values
                    datasets: [{
                        label: 'L_tot / L_Edd',
                        data: [], // L_tot values
                        borderColor: '#fcd34d', // Yellow line
                        backgroundColor: 'rgba(252, 211, 77, 0.1)', // Light yellow fill
                        borderWidth: 2,
                        pointRadius: 0, // No points
                        tension: 0.1, // Slightly smooth curve
                        fill: true 
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: { display: true, text: '', font: { size: 14 } }, // Title set by switchLanguage
                            min: 0.90,
                            max: 1.00
                        },
                        y: {
                            title: { display: true, text: '', font: { size: 14 } }, // Title set by switchLanguage
                             min: 0,
                             max: 15, // Adjusted max for better visibility
                             ticks: { stepSize: 1 } 
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                             callbacks: {
                                 label: function(context) {
                                     let label = context.dataset.label || '';
                                     if (label) { label += ': '; }
                                     if (context.parsed.y !== null) {
                                         label += context.parsed.y.toFixed(2);
                                     }
                                     return label;
                                 }
                             }
                        },
                         annotation: { // Vertical line at threshold
                             annotations: [{
                                 type: 'line',
                                 mode: 'vertical',
                                 scaleID: 'x',
                                 value: A_THRESHOLD,
                                 borderColor: 'rgb(244, 63, 94)', // Red threshold line
                                 borderWidth: 2,
                                 borderDash: [6, 6],
                                 label: {
                                     enabled: true,
                                     content: `a* = ${A_THRESHOLD} (Threshold)`,
                                     position: 'start',
                                     backgroundColor: 'rgba(244, 63, 94, 0.8)',
                                     font: { size: 10 }
                                 }
                             },{ // Horizontal line at L_Edd=1
                                 type: 'line',
                                 mode: 'horizontal',
                                 scaleID: 'y',
                                 value: 1.0,
                                 borderColor: 'rgb(56, 189, 248)', // Blue base line
                                 borderWidth: 2,
                                 borderDash: [3, 3],
                                 label: {
                                     enabled: true,
                                     content: `L/L_Edd = 1 (Accretion Only)`,
                                     position: 'start',
                                     backgroundColor: 'rgba(56, 189, 248, 0.8)',
                                     font: { size: 10 }
                                 }
                             }]
                         }
                    }
                }
            });

            // --- Event Listeners ---
            spinSlider.addEventListener('input', () => {
                const spin = parseFloat(spinSlider.value);
                const coupling = parseFloat(couplingSlider.value);
                document.getElementById('spin-value').textContent = spin.toFixed(3);
                const totalLuminosity = calculateTotalLuminosity(spin, coupling);
                luminosityValue.textContent = totalLuminosity.toFixed(2);
                updateLuminosityChart(); // Update chart based on current coupling
            });

            couplingSlider.addEventListener('input', () => {
                const spin = parseFloat(spinSlider.value);
                const coupling = parseFloat(couplingSlider.value);
                 document.getElementById('coupling-value').textContent = coupling.toFixed(3);
                const totalLuminosity = calculateTotalLuminosity(spin, coupling);
                luminosityValue.textContent = totalLuminosity.toFixed(2);
                updateLuminosityChart(); // Update chart based on new coupling
            });

            langToggleJa.addEventListener('click', () => switchLanguage('ja'));
            langToggleEn.addEventListener('click', () => switchLanguage('en'));
            animateButton.addEventListener('click', runAnimation);
            
             // Smooth scroll for nav links
             document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('data-target');
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 80, // Adjust for sticky header height
                            behavior: 'smooth'
                        });
                        // Update active state
                        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });

            // Initial setup
            // Set initial language and render content
            switchLanguage(currentLang); 
            // Trigger initial calculation and chart update
            spinSlider.dispatchEvent(new Event('input')); 
        });
    </script>
    <!-- Chart.js Annotation Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0/dist/chartjs-plugin-annotation.min.js"></script>
</body>
</html>
